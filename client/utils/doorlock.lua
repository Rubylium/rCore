

local doords = {
    {
        double = true,
        job = {["police"] = true, ["sheriff"] = true},
        pos = {
            {pos = vector3(-440.81521606445, 6007.4604492188,31.871360778809), model = -2023754432, heading = 135.43254089355,},
            {pos = vector3(-442.65530395508, 6009.2998046875,31.871360778809), model = -2023754432, heading = 315.50006103516,},
        }   
    },

    {
        double = true,
        job = {["police"] = true, ["sheriff"] = true},
        pos = {
            {pos = vector3(-442.85778808594, 6010.9580078125,31.865228652954), model = -2023754432, heading = 44.56713104248,},
            {pos = vector3(-441.01849365234, 6012.794921875,31.865228652954), model = -2023754432, heading = 225.32643127441,},
        }
    },

    {
        double = true,
        job = {["police"] = true, ["sheriff"] = true},
        pos = {
            {pos = vector3(-447.72830200195, 6006.7016601563,31.865228652954), model = -2023754432, heading = 135.00006103516},
            {pos = vector3(-449.56558227539, 6008.5380859375,31.865228652954), model = -2023754432, heading = 315.01040649414},
        }
    },

    {
        double = false,
        job = {["police"] = true, ["sheriff"] = true},
        pos = {pos = vector3(-454.04354858398, 6010.2426757813,31.861061096191), model = -2023754432, heading = 44.999935150146},
    },

    {
        double = false,
        job = {["police"] = true, ["sheriff"] = true},
        pos = {pos = vector3(-437.04159545898, 6003.7045898438,31.868148803711), model = 749848321, heading = 135.00006103516},
    },

    {
        double = false,
        job = {["police"] = true, ["sheriff"] = true},
        pos = {pos = vector3(-450.96636962891, 6006.0864257813,31.990036010742), model = -2023754432, heading = 135.00006103516},
    },

    {
        double = false,
        job = {["police"] = true, ["sheriff"] = true},
        pos = {pos = vector3(-447.23629760742, 6002.3168945313,31.840034484863), model = -2023754432, heading = 315.59310913086},
    },

    {
        double = false,
        job = {["police"] = true, ["sheriff"] = true},
        pos = {pos = vector3(-438.22802734375, 6006.1665039063,28.135578155518), model = -1927754726, heading = 44.999965667725},
    },

    {
        double = false,
        job = {["police"] = true, ["sheriff"] = true},
        pos = {pos = vector3(-442.10824584961, 6010.0517578125,28.135578155518), model = -1927754726, heading = 44.999965667725},
    },

    {
        double = false,
        job = {["police"] = true, ["sheriff"] = true},
        pos = {pos = vector3(-444.36822509766, 6012.22265625,28.135578155518), model = -1927754726, heading = 44.999965667725},
    },

    {
        double = true,
        job = {["police"] = true, ["sheriff"] = true},
        pos = {
            {pos = vector3(-434.67764282227, 6009.6801757813,28.1383934021), model = -1320876379, heading = 45.000015258789},
            {pos = vector3(-436.51574707031, 6007.84375,28.1383934021), model = -1320876379, heading = 225.0001373291},
        }
    },

    {
        double = false,
        job = {["police"] = true, ["sheriff"] = true},
        pos = {pos = vector3(-436.62759399414, 6002.5483398438,28.140621185303), model = 749848321, heading = 45.000015258789},
    },

    {
        double = false,
        job = {["police"] = true, ["sheriff"] = true},
        pos = {pos = vector3(-433.93756103516, 6005.2778320313,28.140621185303), model = 749848321, heading = 225.0001373291},
    },



    -- SANDY SHORE BCSO

    {
        double = false,
        job = {["police"] = true, ["sheriff"] = true},
        pos = {pos = vector3(1855.708984375, 3683.9328613281,34.593639373779), model = -1765048490, heading = 29.409164428711},
    },

    {
        double = false,
        job = {["police"] = true, ["sheriff"] = true},
        pos = {pos = vector3(1858.1571044922, 3699.1364746094,34.546348571777), model = 1526539404, heading = 210.00016784668},
    },

    {
        double = false,
        job = {["police"] = true, ["sheriff"] = true},
        pos = {pos = vector3(1844.2640380859, 3694.1518554688,34.416557312012), model = -519068795, heading = 299.6628112793},
    },

    {
        double = true,
        job = {["police"] = true, ["sheriff"] = true},
        pos = {
            {pos = vector3(1851.2879638672, 3681.8701171875,34.416557312012), model = -2023754432, heading = 120.43684387207},
            {pos = vector3(1849.9820556641, 3684.1149902344,34.416557312012), model = -2023754432, heading = 299.86767578125},
        }
    },

    {
        double = true,
        job = {["police"] = true, ["sheriff"] = true},
        pos = {
            {pos = vector3(1847.1330566406, 3689.9460449219,34.418418884277), model = -2023754432, heading = 29.143821716309},
            {pos = vector3(1849.4000244141, 3691.2060546875,34.418418884277), model = -2023754432, heading = 209.06301879883},
        }
    },


    {
        double = false,
        job = {["police"] = true, ["sheriff"] = true},
        pos = {pos = vector3(1852.9210205078, 3686.4069824219,30.413888931274), model = 749848321, heading = 29.874879837036},
    },

    {
        double = false,
        job = {["police"] = true, ["sheriff"] = true},
        pos = {pos = vector3(1856.1600341797, 3688.2680664063,30.413888931274), model = 749848321, heading = 29.874879837036},
    },


    {
        double = false,
        job = {["police"] = true, ["sheriff"] = true},
        pos = {pos = vector3(1859.6965332031, 3686.6442871094,30.409215927124), model = 631614199, heading = 299.99990844727},
    },

    {
        double = false,
        job = {["police"] = true, ["sheriff"] = true},
        pos = {pos = vector3(1858.9982910156, 3694.9365234375,30.409215927124), model = 631614199, heading = 300.00003051758},
    },

    {
        double = false,
        job = {["police"] = true, ["sheriff"] = true},
        pos = {pos = vector3(1860.8978271484, 3691.6433105469,30.409215927124), model = 631614199, heading = 300.00003051758},
    },

    {
        double = false,
        job = {["police"] = true, ["sheriff"] = true},
        pos = {pos = vector3(1862.7633056641, 3688.4138183594,30.409215927124), model = 631614199, heading = 300.00003051758},
    },



    -- VESPUCCI


    {
        double = true,
        job = {["police"] = true, ["sheriff"] = true},
        pos = {
            {pos = vector3(-1093.1550292969, -819.28381347656,19.186269760132), model = -1255368438, heading = 217.1043548584},
            {pos = vector3(-1091.1040039063, -817.72540283203,19.186269760132), model = -1255368438, heading = 37.374889373779},
        }
    },


    {
        double = false,
        job = {["police"] = true, ["sheriff"] = true},
        pos = {pos = vector3(-1077.8118896484, -830.57299804688,19.198949813843), model = -147325430, heading = 37.568542480469},
    },

    {
        double = true,
        job = {["police"] = true, ["sheriff"] = true},
        pos = {
            {pos = vector3(-1099.3489990234, -834.56329345703,19.152320861816), model = -1255368438, heading = 127.29434967041},
            {pos = vector3(-1097.7839355469, -836.60949707031,19.152980804443), model = -1255368438, heading = 307.2317199707},
        }
    },

    {
        double = true,
        job = {["police"] = true, ["sheriff"] = true},
        pos = {
            {pos = vector3(-1095.5549316406, -843.47827148438,19.150720596313), model = -1255368438, heading = 127.34727478027},
            {pos = vector3(-1093.9899902344, -845.52502441406,19.150720596313), model = -1255368438, heading = 307.44747924805},
        }
    },


    {
        double = true,
        job = {["police"] = true, ["sheriff"] = true},
        pos = {
            {pos = vector3(-1094.0969238281, -816.2119140625,5.6305637359619), model = -2023754432, heading = 307.44747924805},
            {pos = vector3(-1092.5198974609, -818.27398681641,5.6305637359619), model = -2023754432, heading = 127.34727478027},
        }
    },

    {
        double = true,
        job = {["police"] = true, ["sheriff"] = true},
        pos = {
            {pos = vector3(-1090.7269287109, -836.03729248047,5.6320953369141), model = -2023754432, heading = 127.57680511475},
            {pos = vector3(-1092.3039550781, -833.97570800781,5.6320953369141), model = -2023754432, heading = 307.82446289063},
        }
    },

    {
        double = true,
        job = {["police"] = true, ["sheriff"] = true},
        pos = {
            {pos = vector3(-1066.1119384766, -827.07928466797,5.6305637359619), model = -2023754432, heading = 307.44747924805},
            {pos = vector3(-1064.5360107422, -829.14050292969,5.6305637359619), model = -2023754432, heading = 127.34727478027},
        }
    },


    {
        double = true,
        job = {["police"] = true, ["sheriff"] = true},
        pos = {
            {pos = vector3(-1066.1119384766, -827.07928466797,5.6305637359619), model = -2023754432, heading = 307.44747924805},
            {pos = vector3(-1064.5360107422, -829.14050292969,5.6305637359619), model = -2023754432, heading = 127.34727478027},
        }
    },


    {
        double = false,
        job = {["police"] = true, ["sheriff"] = true},
        pos = {pos = vector3(-1073.5805664063, -827.48541259766,5.6305637359619), model = 631614199, heading = 217.55847167969},
    },
    {
        double = false,
        job = {["police"] = true, ["sheriff"] = true},
        pos = {pos = vector3(-1087.7518310547, -829.87469482422,5.6305637359619), model = 631614199, heading = 217.1043548584},
    },
    {
        double = false,
        job = {["police"] = true, ["sheriff"] = true},
        pos = {pos = vector3(-1085.8259277344, -827.83862304688,5.6305637359619), model = 631614199, heading = 307.44747924805},
    },
    {
        double = false,
        job = {["police"] = true, ["sheriff"] = true},
        pos = {pos = vector3(-1088.796875, -830.25329589844,5.6305637359619), model = 631614199, heading = 307.44747924805},
    },
    {
        double = false,
        job = {["police"] = true, ["sheriff"] = true},
        pos = {pos = vector3(-1091.1400146484, -827.00054931641,5.6305637359619), model = 631614199, heading = 307.44747924805},
    },
    {
        double = false,
        job = {["police"] = true, ["sheriff"] = true},
        pos = {pos = vector3(-1088.2309570313, -824.77227783203,5.6305637359619), model = 631614199, heading = 307.44747924805},
    },
    {
        double = false,
        job = {["police"] = true, ["sheriff"] = true},
        pos = {pos = vector3(-1093.5518798828, -823.85827636719,5.6305637359619), model = 631614199, heading = 307.44747924805},
    },
    {
        double = false,
        job = {["police"] = true, ["sheriff"] = true},
        pos = {pos = vector3(-1090.6400146484, -821.62750244141,5.6305637359619), model = 631614199, heading = 307.44747924805},
    },
    {
        double = false,
        job = {["police"] = true, ["sheriff"] = true},
        pos = {pos = vector3(-1095.95703125, -820.72540283203,5.6305637359619), model = 631614199, heading = 307.44747924805},
    },
    {
        double = false,
        job = {["police"] = true, ["sheriff"] = true},
        pos = {pos = vector3(-1070.7868652344, -834.05194091797,5.6303462982178), model = -147325430, heading = 127.51894378662},
    },


    {
        double = true,
        job = {["police"] = true, ["sheriff"] = true},
        pos = {
            {pos = vector3(-1091.0390625, -846.67645263672,5.0412549972534), model = -2023754432, heading = 307.44747924805},
            {pos = vector3(-1089.4630126953, -848.73852539063,5.0412549972534), model = -2023754432, heading = 127.34727478027},
        }
    },

    {
        double = true,
        job = {["police"] = true, ["sheriff"] = true},
        pos = {
            {pos = vector3(-1056.7559814453, -839.11529541016,5.3037819862366), model = -2023754432, heading = 217.07241821289},
            {pos = vector3(-1058.8229980469, -840.68780517578,5.3041172027588), model = -2023754432, heading = 36.76390838623},
        }
    },

    {
        double = false,
        job = {["drusilla"] = true},
        pos = {pos = vector3(290.77651977539, -964.37573242188,29.682369232178), model = 774795636, heading = 180.14141845703},
    },

    {
        double = false,
        job = {["hotdogs"] = true},
        pos = {pos = vector3(39.562496185303, -1006.3271484375,29.464735031128), model = 661129475, heading = 69.947204589844},
    },

    {
        double = false,
        job = {["bestbuds"] = true},
        pos = {pos = vector3(381.42156982422, -825.16284179688,29.45322227478), model = -538477509, heading = 180.00003051758},
    },
}

local DoorCache = {}

RegisterNetEvent("core:ChangeDoorStatus")
AddEventHandler("core:ChangeDoorStatus", function(pos, model, heading, status)
    local obj = GetClosestObjectOfType(pos, 2.0, model, false, false, false)
    FreezeEntityPosition(obj, status)
    SetEntityHeading(obj, heading)
    if DoorCache[obj] == nil then DoorCache[obj] = {} end
    DoorCache[obj].status = status
end)

RegisterNetEvent("core:ChangeDoubleDoorStatus")
AddEventHandler("core:ChangeDoubleDoorStatus", function(door1, door2, status)
    local obj = GetClosestObjectOfType(door1.pos, 2.0, door1.model, false, false, false)
    FreezeEntityPosition(obj, status)
    SetEntityHeading(obj, door1.heading)
    if DoorCache[obj] == nil then DoorCache[obj] = {} end
    DoorCache[obj].status = status

    local obj2 = GetClosestObjectOfType(door2.pos, 2.0, door2.model, false, false, false)
    FreezeEntityPosition(obj2, status)
    SetEntityHeading(obj2, door2.heading)
    if DoorCache[obj2] == nil then DoorCache[obj2] = {} end
    DoorCache[obj2].status = status
end)


Citizen.CreateThread(function()
    while true do
        Wait(1500)
        for _,v in pairs(doords) do
            if not v.double then
                local obj = GetClosestObjectOfType(v.pos.pos, 2.0, v.pos.model, false, false, false)
                if not obj then break end
                if DoorCache[obj] == nil then
                    DoorCache[obj] = {}
                    DoorCache[obj].status = true
                    FreezeEntityPosition(obj, true)
                end
            else
                local obj = GetClosestObjectOfType(v.pos[1].pos, 2.0, v.pos[1].model, false, false, false)
                if not obj then break end
                if DoorCache[obj] == nil then
                    DoorCache[obj] = {}
                    DoorCache[obj].status = true
                    FreezeEntityPosition(obj, true)
                end


                local obj = GetClosestObjectOfType(v.pos[2].pos, 2.0, v.pos[2].model, false, false, false)
                if not obj then break end
                if DoorCache[obj] == nil then
                    DoorCache[obj] = {}
                    DoorCache[obj].status = true
                    FreezeEntityPosition(obj, true)
                end
            end
        end
    end
end)


Citizen.CreateThread(function()
    while true do
        local nearDoor = false
        for _,v in pairs(doords) do
            if not v.double then
                local dst = #(GetEntityCoords(pPed) - v.pos.pos)
                if dst <= 1.5 then
                    nearDoor = true
                    local obj = GetClosestObjectOfType(v.pos.pos, 2.0, v.pos.model, false, false, false)
                    if DoorCache[obj] == nil then break end
                    if DoorCache[obj].status ~= true then
                        DrawTxt(GetEntityCoords(obj), "Appuyer sur E pour ouvrir la porte.")
                    else
                        DrawTxt(GetEntityCoords(obj), "Appuyer sur E pour fermer la porte.")
                    end
                    if IsControlJustReleased(1, 38) then
                        if v.job[pJob] ~= nil then
                            if DoorCache[obj].status == true then
                                local player = rUtils.GetPlayersInScope()
                                TriggerServerEvent(events.DoorStatus, token, player, v.pos.pos, v.pos.model, v.pos.heading, false)
                            else
                                local player = rUtils.GetPlayersInScope()
                                TriggerServerEvent(events.DoorStatus, token, player, v.pos.pos, v.pos.model, v.pos.heading, true)
                            end
                        end
                    end


                    break
                end
            else

                local dst = #(GetEntityCoords(pPed) - v.pos[1].pos)
                if dst <= 2.5 then
                    nearDoor = true
                    local obj = GetClosestObjectOfType(v.pos[1].pos, 2.0, v.pos[1].model, false, false, false)
                    if DoorCache[obj] ~= nil then
                        DrawTxt(GetEntityCoords(obj), "Appuyer sur E pour ouvrir les portes.")
                    else
                        DrawTxt(GetEntityCoords(obj), "Appuyer sur E pour fermer les portes.")
                    end
                    if IsControlJustReleased(1, 38) then
                        if v.job[pJob] ~= nil then
                            if DoorCache[obj].status == true then
                                local player = rUtils.GetPlayersInScope()
                                TriggerServerEvent(events.DoubleDoorStatus, token, player, v.pos[1], v.pos[2], false)
                            else
                                local player = rUtils.GetPlayersInScope()
                                TriggerServerEvent(events.DoubleDoorStatus, token, player, v.pos[1], v.pos[2], true)
                            end
                        end
                    end


                    break
                end
            end

                
        end

        if nearDoor then
            Wait(1)
        else
            Wait(750)
        end
    end
end)